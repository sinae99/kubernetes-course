## A - commands
### 1. create container rootfs

create parent folder to act as `/` for our process in its namespace 

and add `busybox` :

`BusyBox`  ---->  a tiny shell + tools with no dependencies.

symlinks (`sh`, `ls`, `ps`) let BusyBox act like multiple commands

```bash
mkdir -p mycontainer1/{bin,proc}
cp /usr/bin/busybox mycontainer1/bin/
cd mycontainer1/bin
ln -s busybox sh
ln -s busybox ls
ln -s busybox ps
ln -s busybox echo
cd -
```

### 2. enter isolated namespaces
```bash
sudo unshare --pid --uts --ipc --mount --fork --mount-proc bash
```
create new namespaces and run the next command inside them

`--fork`  ----> after creating the new namespaces, create a child into them and run the command (bash) inside those namespaces


### 3. mount /proc for the container
```bash
mount -t proc none mycontainer1/proc
```

`-t proc`  ---> mount a `proc filesystem` (procfs is a virtual filesystem the kernel generates)   

`none` ---> a fake device to just obey command syntax, because procfs is NOT stored on a disk (mount no device on my mount point: `mycontainer/proc`)

we need a `/proc` that belongs to our ns

### 4. enter container filesystem
```bash
chroot mycontainer1 /bin/sh
```

### 5. test
```
/ # ls
/ # echo $$
/ # ps
/ # hostname sag
```

---

## B - my notes

### Stage 1 — why create root fs ?

CONTAINER = NAMESPACES + FILESYSTEM + PROCESS

---

### Stage 2 — unshare

WHAT the process sees ----> using `namespaces`

WHERE the process lives ----> using `chroot`

WHO the process is ----> the binary you run inside


```bash
sudo unshare --pid --uts --ipc --mount --fork --mount-proc bash
```
This creates new namespaces:
- **PID** → isolated process IDs  
- **UTS** → own hostname  
- **IPC** → isolated IPC objects  
- **Mount** → private mount table  
- **mount-proc** → new `/proc` matching this PID namespace  

The new `bash` becomes **PID 1** inside this new world.

---

### Stage 3 — /proc?
new PID namespace needs its own `/proc`, otherwise `ps` would show `host` processes.

/proc from `--mount-proc` ----> it reflects the PID namespace created by unshare.

Inside the new mount namespace ----> mount a fresh procfs at /proc

that shows ONLY processes inside this PID namespace

```bash
mount -t proc none mycontainer/proc
```
/bin/sh insdie the container fs ----> use mycontainer/proc as its /proc

---

### Stage 4 — chroot + /bin/sh
`bash` (PID1) still sees the *host* filesystem.  
to enter our container filesystem :

```bash
chroot mycontainer1 /bin/sh
```

this launches a new process **inside the container filesystem**.

Inside:
- `bash` = PID1, parent, manages namespace  
- `sh`   = child process inside container rootfs

---

### Stage 5 — What each process sees

| Process | Namespaces | Filesystem | PID inside ns |
|---------|------------|------------|----------------|
| `bash` (PID1) | new PID/UTS/IPC/MNT | host FS | 1 |
| `sh` (chroot) | same namespaces | mycontainer1/ | sth like 9 |

This is a real minimal container:  
isolated PIDs, isolated `/proc`, isolated FS root, own hostname.

---



