
## A – Commands

### 1. create 2 isolated processes wih Network Namespaces

In **two different terminals**:

```bash
sudo unshare --net --fork bash
echo "PID = $$"
ip addr       # should show only 'lo'
```

`unshare` command creates ------>

- **NET** namespace → isolated network stack  
- `bash` runs inside that namespace  
- Save the two PIDs: `<PID1>` and `<PID2>`

---

### 2. create a "Linux Bridge" on the host (Virtual Switch)

In the **host terminal**:

```bash
sudo ip link add br0 type bridge
sudo ip link set br0 up
ip link show br0
```

`br0` → the virtual switch all namespaces will connect to  

like `docker0`

---

### 3. connect ns 1 to the  br0

In **host terminal**:

```bash
sudo ip link add veth-ns1 type veth peer name veth-br1
sudo ip link set veth-ns1 netns <PID1>
sudo ip link set veth-br1 master br0
sudo ip link set veth-br1 up
```

Inside **Namespace 1 terminal**:

```bash
ip link set veth-ns1 up
ip addr
```

---

### 4. connect ns 2 to the br0

In **host terminal**:

```bash
sudo ip link add veth-ns2 type veth peer name veth-br2
sudo ip link set veth-ns2 netns <PID2>
sudo ip link set veth-br2 master br0
sudo ip link set veth-br2 up
```

Inside **Namespace 2 terminal**:

```bash
ip link set veth-ns2 up
ip addr
```

---

### 5. assign IP

Inside **Namespace 1**:

```bash
ip addr add 10.10.0.1/24 dev veth-ns1
ip link set lo up
```

Inside **Namespace 2**:

```bash
ip addr add 10.10.0.2/24 dev veth-ns2
ip link set lo up
```

---

### 6. Test Connectivity

From **Namespace 1**:

```bash
ping 10.10.0.2
```


---

## B – Notes

### Concept: Container Networking 

A minimal container networking setup includes:

| Component | Purpose |
|----------|----------|
| **Network namespace** | Isolated network stack per process |
| **veth pair** | Virtual cable connecting namespaces |
| **bridge (br0)** | Virtual switch connecting multiple containers |
| **IP assignment** | Gives each namespace identity on the network |

---

### How Data Flows

```
NS1 (veth-ns1) ↔ veth-br1 ↔ br0 ↔ veth-br2 ↔ veth-ns2 (NS2)
```

- veth pairs act like cables  
- br0 forwards Ethernet frames (Layer 2 switch)  
- same subnet (/24) → no router needed  
- once IPs assigned, ping uses ARP + ICMP normally  

---

### Summary

You manually recreated the key parts of a container runtime’s network setup:

- `unshare` → create per-process network namespaces  
- `veth` → connect isolated namespaces  
- `bridge` → shared L2 domain  
- `ip addr` → assign addresses  
- `ping` → verify connectivity  

This mirrors how Docker and Kubernetes (CNI) connect pods on the same node.
